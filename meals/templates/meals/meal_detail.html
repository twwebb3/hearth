{% extends "base.html" %}

{% block title %}{{ meal.name }} - Meals{% endblock %}

{% block content %}
<div style="margin-bottom: 16px;">
    <a href="{% url 'meals:week' %}">&larr; Back to week</a>
</div>

<div class="card">
    <h1 style="margin: 0 0 8px 0;">{{ meal.name }}</h1>
    <div style="color: #6b7280; margin-bottom: 12px;">
        <span>{{ meal.date|date:"l, F j, Y" }}</span>
        <span style="margin-left: 12px; text-transform: capitalize;">{{ meal.meal_type }}</span>
    </div>

    {% if meal.notes %}
    <div style="margin-bottom: 16px; padding: 12px; background: #f9fafb; border-radius: 8px;">
        <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Notes</div>
        <div>{{ meal.notes|linebreaks }}</div>
    </div>
    {% endif %}

    <h2 style="margin: 20px 0 12px 0; font-size: 1.1rem;">Ingredients</h2>

    {% if meal.ingredients %}
    <ul style="list-style: none; padding: 0; margin: 0 0 16px 0;">
        {% for ingredient in meal.ingredients %}
        <li style="padding: 8px 0; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 10px;">
            <form method="post" action="{% url 'meals:ingredient_toggle' pk=ingredient.id %}" style="margin: 0;">
                {% csrf_token %}
                <input type="hidden" name="meal_id" value="{{ meal.id }}">
                <input type="checkbox" {% if ingredient.is_on_hand %}checked{% endif %} onchange="this.form.submit()" style="cursor: pointer;" title="Mark as on hand">
            </form>
            <span style="{% if ingredient.is_on_hand %}text-decoration: line-through; color: #9ca3af;{% endif %}">
                {{ ingredient.name }}{% if ingredient.quantity %} <span style="color: #6b7280;">({{ ingredient.quantity }})</span>{% endif %}
            </span>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p style="color: #9ca3af; margin: 0 0 16px 0;">No ingredients added yet.</p>
    {% endif %}

    <form method="post" action="{% url 'meals:ingredient_add' meal_pk=meal.id %}" style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
        {% csrf_token %}
        <input type="text" name="name" placeholder="Ingredient name" required style="flex: 2; min-width: 150px; padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
        <input type="text" name="quantity" placeholder="Quantity (optional)" style="flex: 1; min-width: 100px; padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px;">
        <button type="submit" class="btn-link" style="white-space: nowrap;">Add ingredient</button>
    </form>
</div>

<div style="margin-top: 16px;">
    <a href="{% url 'meals:meal_edit' pk=meal.id %}" class="btn-link" style="text-decoration: none; display: inline-block;">Edit meal</a>
</div>
{% endblock %}
